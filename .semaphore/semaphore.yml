version: v1.0
name: Pouring

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: Pour
    task:
      jobs:
        - name: Build & Push
          commands:
            - export BRANCH=$SEMAPHORE_GIT_BRANCH
            - export PROJECT_PATHNAME=$SEMAPHORE_GIT_REPO_SLUG
            - export REVISION=$SEMAPHORE_GIT_SHA
            - export REGISTRY_HOST=registry.ghzmdr.tk
            - echo $BRANCH
            - echo $PROJECT_PATHNAME
            - echo $REVISION
            - echo $REGISTRY_HOST
            - checkout
            - ls -l
            - docker-compose -f build.yml build
            - docker-compose -f build.yml push
