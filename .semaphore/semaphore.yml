version: v1.0
name: Pouring

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: Pour
    task:
      jobs:
        - name: Build & Push
          commands:
            - set -ex
            - export BRANCH=$BRANCH_NAME
            - export PROJECT_PATHNAME=$SEMAPHORE_REPO_SLUG
            - export REVISION=$REVISION
            - export REGISTRY_HOST=registry.ghzmdr.tk
            - checkout
            - ls -l
            - docker-compose -f build.yml build
            - docker-compose -f build.yml push
